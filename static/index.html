<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Counter</title>
    <!-- Add IBM Plex Sans font -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <!-- Add Prism.js CSS and JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet">
    <style>
        :root {
            --site-bg-color: #FBFAE9;
            --text-primary: #000000;
            --link-color: #F47B54;
            --link-hover: #D35A34;
            --code-bg: #2D2D2D;
            --heading-color: #000000;
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background-color: var(--site-bg-color);
            color: var(--text-primary);
        }

        /* Theme overrides for Prism */
        pre[class*="language-"] {
            background: var(--code-bg);
            border: none;
            border-radius: 8px;
            margin: 1.5em 0;
            font-family: 'IBM Plex Mono', monospace;
            padding-top: 2.5em;
        }

        code[class*="language-"] {
            text-shadow: none;
            color: #E5E5E5;
            font-family: 'IBM Plex Mono', monospace;
        }

        .token.comment { color: #888888; }
        .token.string { color: #98C379; }
        .token.number { color: #D19A66; }
        .token.keyword { color: #C678DD; }
        .token.function { color: #61AFEF; }
        .token.operator { color: #56B6C2; }

        .code-toolbar {
            position: relative;
        }

        .code-toolbar > .toolbar {
            opacity: 1;
            top: 0.5em;
            right: 0.5em;
        }

        .code-toolbar > .toolbar > .toolbar-item > button {
            background: #3D3D3D;
            color: #E5E5E5;
            border: none;
            border-radius: 4px;
            padding: 0.4rem 0.8rem;
            font-size: 0.875rem;
            font-family: 'IBM Plex Sans', sans-serif;
            transition: background-color 0.2s;
        }

        .code-toolbar > .toolbar > .toolbar-item > button:hover {
            background: #4D4D4D;
        }

        .language-label {
            position: absolute;
            top: 0.5rem;
            left: 1rem;
            font-size: 0.8rem;
            color: #888888;
            font-family: 'IBM Plex Sans', sans-serif;
            z-index: 10;
        }

        #docTitle {
            color: var(--heading-color);
        }

        .nav-tabs .nav-link {
            color: var(--text-primary);
            border: none;
            padding: 0.5rem 1rem;
            margin-right: 1rem;
            font-weight: 500;
        }

        .nav-tabs .nav-link.active {
            background: none;
            border-bottom: 2px solid var(--link-color);
            color: var(--link-color);
        }

        .btn-secondary {
            background-color: var(--link-color);
            border: none;
            padding: 0.5rem 1.5rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .btn-secondary:hover {
            background-color: var(--link-hover);
        }

        .language-selector {
            margin-bottom: 1rem;
        }

        .code-examples > div {
            display: none;
        }

        .code-examples > div.active {
            display: block;
        }

        .card {
            background-color: transparent;
            border: none;
            border-radius: 0;
        }

        .container {
            max-width: 900px;
        }

        h1, h5, h6 {
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-control {
            background-color: white;
            border: 1px solid #DDD;
            border-radius: 4px;
            color: #000000;
        }

        .form-control:focus {
            border-color: var(--link-color);
            box-shadow: 0 0 0 0.2rem rgba(244, 123, 84, 0.25);
            background-color: white;
            color: #000000;
        }

        .form-control::placeholder {
            color: #6c757d;
            opacity: 1;
        }

        #visualizationSection canvas {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
        }
        .language-selector select.form-select {
            background-color: white;
            border: 1px solid #DDD;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-family: 'IBM Plex Sans', sans-serif;
            color: var(--text-primary); 
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .language-selector select.form-select:hover {
            border-color: var(--link-color);
        }

        .language-selector select.form-select:focus {
            border-color: var(--link-color);
            box-shadow: 0 0 0 0.2rem rgba(244, 123, 84, 0.25);
            outline: none;
        }

        .language-selector {
            margin-bottom: 1rem;
            max-width: 200px;
        }

        /* Make lead paragraph text smaller */
        .lead {
            font-size: 16px !important;
        }

        /* Form inputs and text areas should inherit the text color */
        .form-control, 
        .form-select,
        .nav-tabs .nav-link,
        p,
        label,
        .card-title {
            color: var(--text-primary);
        }

        /* Add styles for drag and drop */
        .drag-drop-zone {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drag-drop-zone.dragover {
            border-color: var(--link-color);
            background-color: rgba(244, 123, 84, 0.1);
        }

        .drag-drop-zone .upload-icon {
            font-size: 2.5rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }

        .drag-drop-zone .upload-text {
            margin-bottom: 0.5rem;
            color: #6c757d;
        }

        .drag-drop-zone .upload-subtext {
            font-size: 0.875rem;
            color: #6c757d;
        }

        #inputFile {
            display: none;
        }

        .progress-bar {
            background-color: var(--link-color);
        }

        .progress-bar-striped {
            background-image: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.15) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.15) 75%,
                transparent 75%,
                transparent
            );
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-3">Word Counter</h1>
        <p class="lead mb-4">
            Analyze text content by counting word frequencies and visualizing the results. Simply paste your text or upload a file (PDF, Markdown, or TXT) in the Try It section below. The analyzer will ignore numbers, special characters, and URLs, focusing only on meaningful words. Results include word frequencies and an interactive chart showing the most common words.
        </p>

        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="try-tab" data-bs-toggle="tab" data-bs-target="#try-it" type="button" role="tab">Try It</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="docs-tab" data-bs-toggle="tab" data-bs-target="#documentation" type="button" role="tab">API Documentation</button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabsContent">
            <!-- Try It Tab -->
            <div class="tab-pane fade show active" id="try-it" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Try it out</h5>
                        <ul class="nav nav-tabs mb-3" id="inputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="text-tab" data-bs-toggle="tab" data-bs-target="#text-input" type="button" role="tab">Text Input</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#file-input" type="button" role="tab">File Upload</button>
                            </li>
                        </ul>
                        <div class="tab-content" id="inputTabsContent">
                            <div class="tab-pane fade show active" id="text-input" role="tabpanel">
                                <div class="mb-3">
                                    <label for="inputText" class="form-label">Enter text to analyze:</label>
                                    <textarea class="form-control" id="inputText" rows="3" placeholder="Enter some text here..."></textarea>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="file-input" role="tabpanel">
                                <div class="mb-3">
                                    <label class="form-label">Upload a file (PDF, MD, or TXT):</label>
                                    <div class="drag-drop-zone" id="dragDropZone">
                                        <i class="bi bi-cloud-upload upload-icon"></i>
                                        <p class="upload-text">Drag and drop your file here</p>
                                        <p class="upload-subtext">or click to browse</p>
                                        <input type="file" class="form-control" id="inputFile" accept=".pdf,.md,.txt">
                                    </div>
                                    <!-- Add progress bar container -->
                                    <div id="uploadProgress" class="mt-3" style="display: none;">
                                        <div class="progress" style="height: 25px;">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 role="progressbar" 
                                                 style="width: 0%;" 
                                                 aria-valuenow="0" 
                                                 aria-valuemin="0" 
                                                 aria-valuemax="100">0%</div>
                                        </div>
                                        <small class="text-muted mt-1" id="uploadStatus">Preparing upload...</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="analyzeInput()">Analyze</button>

                        <div class="card mt-3" id="visualizationSection" style="display: none;">
                            <div class="card-body">
                                <h5 class="card-title">Word Frequency Visualization</h5>
                                <div class="chart-container" style="position: relative; height:400px; width:100%">
                                    <canvas id="freqChart"></canvas>
                                </div>
                                <div class="mt-3 text-center">
                                    <button class="btn btn-secondary" id="downloadInfographic" onclick="generateInfographic()" style="display: none;">
                                        <i class="bi bi-download"></i> Download Infographic
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3" id="resultsSection" style="display: none;">
                            <h6>Result:</h6>
                            <div class="position-relative">
                                <pre><code class="language-json" id="result">Results will appear here...</code></pre>
                                <button class="btn btn-sm btn-outline-secondary copy-button" onclick="copyResult()">
                                    <i class="bi bi-clipboard"></i> Copy
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- API Documentation Tab -->
            <div class="tab-pane fade" id="documentation" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title" id="docTitle">REST API Documentation</h5>

                        <h6 class="mt-4 mb-3">Text Analysis Endpoint</h6>
                        <p style="color: var(--heading-color)">Analyze text content directly using JSON payload</p>

                        <div class="language-selector">
                            <select class="form-select" onchange="switchLanguage(this.value, 'text-examples')">
                                <option value="curl">cURL</option>
                                <option value="python">Python</option>
                                <option value="javascript">JavaScript</option>
                            </select>
                        </div>

                        <div class="code-examples text-examples">
                            <div class="code-example active" data-language="curl">
                                <pre><code class="language-bash">// cURL
// Example analyzing a Shakespeare quote
curl -X POST http://word-counter.replit.app/api/count-chars \
-H "Content-Type: application/json" \
-d '{
    "text": "To be, or not to be, that is the question"
}'</code></pre>
                            </div>

                            <div class="code-example" data-language="python">
                                <pre><code class="language-python">// Python
import requests

# Example: Analyze text from a string
text = """
In programming we often say:
Hello, World! Hello, Python! Hello, Programming!
"""

response = requests.post(
    'http://word-counter.replit.app/api/count-chars',
    json={'text': text}
)

if response.ok:
    result = response.json()
    print("Word Frequencies:")
    for word, count in result['counts'].items():
        print(f"'{word}': {count} times")
    print(f"\nTotal words: {result['total_length']}")</code></pre>
                            </div>

                            <div class="code-example" data-language="javascript">
                                <pre><code class="language-javascript">// JavaScript
// Example: Analyze a paragraph
const text = `
The quick brown fox jumps over the lazy dog.
The lazy dog sleeps while the quick fox runs.
`;

fetch('http://word-counter.replit.app/api/count-chars', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({ text })
})
.then(response => response.json())
.then(data => {
    console.log('Word Frequencies:', data.counts);
    console.log('Total Words:', data.total_length);
})
.catch(error => console.error('Error:', error));</code></pre>
                            </div>
                        </div>

                        <h6 class="mt-4 mb-3">File Upload Endpoint</h6>
                        <p style="color: var(--heading-color)">Analyze content from PDF, Markdown, or Text files</p>

                        <div class="language-selector">
                            <select class="form-select" onchange="switchLanguage(this.value, 'file-examples')">
                                <option value="curl">cURL</option>
                                <option value="python">Python</option>
                                <option value="javascript">JavaScript</option>
                            </select>
                        </div>

                        <div class="code-examples file-examples">
                            <div class="code-example active" data-language="curl">
                                <pre><code class="language-bash">// cURL
# Upload and analyze a PDF file
curl -X POST http://word-counter.replit.app/api/count-chars \
-F "file=@sample.pdf"

# Upload and analyze a Markdown file
curl -X POST http://word-counter.replit.app/api/count-chars \
-F "file=@README.md"</code></pre>
                            </div>

                            <div class="code-example" data-language="python">
                                <pre><code class="language-python">// Python
import requests
from pathlib import Path

def analyze_file(file_path):
    """Analyze word frequency in a file"""
    file_path = Path(file_path)

    with open(file_path, 'rb') as f:
        response = requests.post(
            'http://word-counter.replit.app/api/count-chars',
            files={'file': (file_path.name, f)}
        )

    if response.ok:
        result = response.json()
        print(f"\nAnalysis of {file_path.name}:")
        # Get top 10 most frequent words
        sorted_words = sorted(
            result['counts'].items(),
            key=lambda x: x[1],
            reverse=True
        )[:10]

        print("\nTop 10 most frequent words:")
        for word, count in sorted_words:
            print(f"'{word}': {count} times")

        print(f"\nTotal words: {result['total_length']}")
    else:
        print(f"Error: {response.json().get('error', 'Unknown error')}")

# Example usage
analyze_file('document.pdf')
analyze_file('notes.md')</code></pre>
                            </div>

                            <div class="code-example" data-language="javascript">
                                <pre><code class="language-javascript">// JavaScript
// Example: File upload from an HTML form
const analyzeFile = async (fileInput) => {
    const file = fileInput.files[0];
    if (!file) {
        console.error('No file selected');
        return;
    }

    const formData = new FormData();
    formData.append('file', file);

    try {
        const response = await fetch('http://word-counter.replit.app/api/count-chars', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            console.log(`Analysis of ${file.name}:`);
            console.log('Word Frequencies:', data.counts);
            console.log('Total Words:', data.total_length);

            // Get top 10 most frequent words
            const sortedWords = Object.entries(data.counts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            console.log('\nTop 10 most frequent words:');
            sortedWords.forEach(([word, count]) => {
                console.log(`'${word}': ${count} times`);
            });
        } else {
            throw new Error(data.error || 'Failed to analyze file');
        }
    } catch (error) {
        console.error('Error:', error.message);
    }
};</code></pre>
                            </div>
                        </div>

                        <h6 class="mt-4 mb-3">Response Format</h6>
                        <pre><code class="language-json">{
    "counts": {
        "the": 4,
        "quick": 2,
        "brown": 1,
        "fox": 2,
        "jumps": 1,
        "over": 1,
        "lazy": 2,
        "dog": 2
    },
    "total_length": 15
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Add Prism.js and its plugins -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        let chart = null;

        // Initialize documentation examples with formatted JSON
        document.addEventListener('DOMContentLoaded', function() {
            const responseExample = {
                "counts": {
                    "the": 4,
                    "quick": 2,
                    "brown": 1,
                    "fox": 2,
                    "jumps": 1,
                    "over": 1,
                    "lazy": 2,
                    "dog": 2
                },
                "total_length": 15
            };
            document.getElementById('responseExample').innerHTML = formatJSON(responseExample);
        });

        function generateRandomColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsla(${hue}, 70%, 50%, 0.6)`;
        }

        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2)
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span>:')
                .replace(/"([^"]+)"(?=[,\n])/g, '<span class="json-string">"$1"</span>')
                .replace(/\b(\d+)\b/g, '<span class="json-number">$1</span>');
        }

        function copyResult() {
            const resultElement = document.getElementById('result');
            const textToCopy = JSON.parse(resultElement.getAttribute('data-raw'));
            navigator.clipboard.writeText(JSON.stringify(textToCopy, null, 2))
                .then(() => {
                    const copyBtn = document.querySelector('.copy-button');
                    copyBtn.innerHTML = '<i class="bi bi-check"></i> Copied!';
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
                    }, 2000);
                });
        }

        function createChart(labels, data) {
            if (chart) {
                chart.destroy();
            }

            const backgroundColor = labels.map(() => generateRandomColor());
            const borderColor = backgroundColor.map(color => color.replace('0.6)', '1)'));

            const ctx = document.getElementById('freqChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Word Frequency',
                        data: data,
                        backgroundColor: backgroundColor,
                        borderColor: borderColor,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                autoSkip: false,
                                maxRotation: 0,
                                minRotation: 0
                            }
                        },
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Add copy to clipboard button to code blocks
        Prism.plugins.toolbar.registerButton('copy-to-clipboard', function(env) {
            const button = document.createElement('button');
            button.innerHTML = '<i class="bi bi-clipboard"></i> Copy';

            button.addEventListener('click', function() {
                const code = env.element.textContent;
                navigator.clipboard.writeText(code).then(function() {
                    button.innerHTML = '<i class="bi bi-check"></i> Copied!';
                    setTimeout(function() {
                        button.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
                    }, 2000);
                });
            });

            return button;
        });

        async function analyzeInput() {
            const resultElement = document.getElementById('result');
            const resultsSection = document.getElementById('resultsSection');
            const visualizationSection = document.getElementById('visualizationSection');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = uploadProgress.querySelector('.progress-bar');
            const uploadStatus = document.getElementById('uploadStatus');

            try {
                let response;
                const activeTab = document.querySelector('#inputTabs .nav-link.active').getAttribute('id');

                if (activeTab === 'text-tab') {
                    const text = document.getElementById('inputText').value;
                    if (!text.trim()) {
                        throw new Error('Please enter some text to analyze');
                    }
                    response = await fetch('/api/count-chars', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ text }),
                    });
                } else {
                    const fileInput = document.getElementById('inputFile');
                    const file = fileInput.files[0];
                    if (!file) {
                        throw new Error('Please select a file');
                    }

                    // Show progress bar for file uploads
                    uploadProgress.style.display = 'block';

                    // Create FormData
                    const formData = new FormData();
                    formData.append('file', file);

                    // Create promise to handle XMLHttpRequest
                    response = await new Promise((resolve, reject) => {
                        const xhr = new XMLHttpRequest();

                        xhr.upload.addEventListener('progress', (e) => {
                            if (e.lengthComputable) {
                                const percentComplete = Math.round((e.loaded / e.total) * 100);
                                progressBar.style.width = percentComplete + '%';
                                progressBar.setAttribute('aria-valuenow', percentComplete);
                                progressBar.textContent = percentComplete + '%';
                                uploadStatus.textContent = 'Uploading file...';
                            }
                        });

                        xhr.addEventListener('load', () => {
                            if (xhr.status >= 200 && xhr.status < 300) {
                                uploadStatus.textContent = 'Upload complete! Processing file...';
                                resolve(new Response(xhr.response, {
                                    status: xhr.status,
                                    statusText: xhr.statusText,
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                }));
                            } else {
                                reject(new Error('Upload failed'));
                            }
                        });

                        xhr.addEventListener('error', () => {
                            uploadStatus.textContent = 'Upload failed!';
                            reject(new Error('Network error occurred'));
                        });

                        xhr.open('POST', '/api/count-chars');
                        xhr.send(formData);
                    });
                }

                const data = await response.json();

                if (response.ok) {
                    // Hide progress bar on success
                    if (activeTab === 'file-tab') {
                        setTimeout(() => {
                            uploadProgress.style.display = 'none';
                            // Reset progress bar
                            progressBar.style.width = '0%';
                            progressBar.setAttribute('aria-valuenow', 0);
                            progressBar.textContent = '0%';
                        }, 1000);
                    }

                    const jsonString = JSON.stringify(data, null, 2);
                    resultElement.textContent = jsonString;
                    // Trigger Prism.js highlighting
                    Prism.highlightElement(resultElement);
                    resultElement.setAttribute('data-raw', JSON.stringify(data));

                    resultsSection.style.display = 'block';
                    visualizationSection.style.display = 'block';

                    const counts = data.counts;
                    const sortedWords = Object.entries(counts)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 20);
                    const labels = sortedWords.map(([word]) => word);
                    const frequencies = sortedWords.map(([,count]) => count);

                    createChart(labels, frequencies);
                } else {
                    throw new Error(data.error || 'Failed to process input');
                }
            } catch (error) {
                // Hide progress bar on error
                uploadProgress.style.display = 'none';
                resultElement.textContent = 'Error: ' + error.message;
                resultsSection.style.display = 'block';
                visualizationSection.style.display = 'none';
            }
        }
        // Updated switchLanguage function
        function switchLanguage(language, exampleClass) {
            document.querySelectorAll(`.${exampleClass} > .code-example`).forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`.${exampleClass} > .code-example[data-language="${language}"]`).classList.add('active');
        }

        // Initialize Prism highlighting
        document.addEventListener('DOMContentLoaded', function() {
            Prism.highlightAll();
        });


        // Drag and drop functionality
        function setupDragAndDrop() {
            const dragDropZone = document.getElementById('dragDropZone');
            const fileInput = document.getElementById('inputFile');

            // Open file dialog when clicking the drag-drop zone
            dragDropZone.addEventListener('click', () => {
                fileInput.click();
            });

            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dragDropZone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            // Handle drag enter and leave
            ['dragenter', 'dragover'].forEach(eventName => {
                dragDropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dragDropZone.addEventListener(eventName, unhighlight, false);
            });

            // Handle dropped files
            dragDropZone.addEventListener('drop', handleDrop, false);

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function highlight(e) {
                dragDropZone.classList.add('dragover');
            }

            function unhighlight(e) {
                dragDropZone.classList.remove('dragover');
            }

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;

                if (files.length > 0) {
                    fileInput.files = files;
                    // Trigger analysis if a file is dropped
                    analyzeInput();
                }
            }

            // Update file input change handler
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    analyzeInput();
                }
            });
        }

        // Initialize drag and drop when the document is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
        });
    </script>
    <script>
    async function generateInfographic() {
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'pt', 'a4');
        const pageWidth = doc.internal.pageSize.width;
        const pageHeight = doc.internal.pageSize.height;

        // Set background
        doc.setFillColor(251, 250, 233); // #FBFAE9
        doc.rect(0, 0, pageWidth, pageHeight, 'F');

        // Add title
        doc.setTextColor(0, 0, 0);
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(24);
        doc.text('Text Analysis Results', pageWidth / 2, 40, { align: 'center' });

        // Add timestamp
        const date = new Date().toLocaleDateString();
        doc.setFontSize(12);
        doc.setFont('helvetica', 'normal');
        doc.text(`Generated on ${date}`, pageWidth / 2, 60, { align: 'center' });

        // Get the data from the current analysis
        const rawData = JSON.parse(document.getElementById('result').getAttribute('data-raw'));
        const totalWords = rawData.total_length;
        const wordCounts = rawData.counts;

        // Add total word count
        doc.setFontSize(18);
        doc.setFont('helvetica', 'bold');
        doc.text('Total Words Analyzed', pageWidth / 2, 100, { align: 'center' });
        doc.setFontSize(36);
        doc.setTextColor(244, 123, 84); // #F47B54
        doc.text(totalWords.toString(), pageWidth / 2, 140, { align: 'center' });

        // Add top words section
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(18);
        doc.text('Most Frequent Words', pageWidth / 2, 200, { align: 'center' });

        // Create bar chart
        const sortedWords = Object.entries(wordCounts)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 10);

        const barWidth = 400;
        const barHeight = 20;
        const barGap = 10;
        const startY = 220;
        const maxCount = Math.max(...sortedWords.map(([,count]) => count));

        // Use the same color generation function as the website chart
        function generateRandomColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsla(${hue}, 70%, 50%, 0.6)`;
        }

        // Convert HSL to RGB for PDF
        function hslToRgb(h, s, l) {
            h /= 360;
            s /= 100;
            l /= 50;
            let r, g, b;
            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }

        sortedWords.forEach(([word, count], index) => {
            const y = startY + (barHeight + barGap) * index;
            const width = (count / maxCount) * barWidth;

            // Generate color and convert to RGB
            const hue = Math.floor(Math.random() * 360);
            const [r, g, b] = hslToRgb(hue, 70, 25);

            // Draw bar
            doc.setFillColor(r, g, b);
            doc.rect((pageWidth - barWidth) / 2, y, width, barHeight, 'F');

            // Add word label
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.setFont('helvetica', 'normal');
            doc.text(word, (pageWidth - barWidth) / 2 - 5, y + barHeight/2, { align: 'right' });

            // Add count label
            doc.text(count.toString(), (pageWidth - barWidth) / 2 + width + 5, y + barHeight/2, { align: 'left' });
        });

        // Add watermark
        doc.setFontSize(10);
        doc.setTextColor(200, 200, 200);
        doc.text('Generated by Word Counter', pageWidth / 2, pageHeight - 20, { align: 'center' });

        // Save the PDF
        doc.save('text-analysis-report.pdf');
    }

    // Modify analyzeInput function to show download button when analysis is complete
    const originalAnalyzeInput = analyzeInput;
    analyzeInput = async function() {
        await originalAnalyzeInput.call(this);
        document.getElementById('downloadInfographic').style.display = 'inline-block';
    };
    </script>
</body>
</html>